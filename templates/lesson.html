<!DOCTYPE html>
<html lang="en">


<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lesson</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
    /**
    * AI-generated-content
    * tool: DeepSeek
    * version: latest
    * usage: I use the prompt "å¦‚ä½•å†™ä¸€ä¸ªåŒºåˆ†ä¸åŒåŒºåŸŸçš„æ¨¡æ¿html", and
    * use the framework but modify CSS components and change the layout to fit our UI design.
    */

        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            height: 100vh;
        }
        header {
            background-color: #2c3e50;
            color: white;
            padding: 10px;
            text-align: center;
        }
        nav {
            background-color: #595d61;
            padding: 10px;
        }
        nav ul {
            list-style-type: none;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: space-around;
        }
        nav ul li a {
            color: white;
            text-decoration: none;
        }
        .header-bar {
            background: linear-gradient(to right, #2c3e50, #4ca1af);
            color: white;
            padding: 15px 20px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .header-bar h1 {
            margin: 0;
            font-size: 24px;
            font-weight: bold;
            letter-spacing: 1px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .header-bar h1 i {
            font-size: 24px;
            color: #ffffffcc;
        }
        .main-nav {
            background-color: #34495e;
            padding: 10px 20px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        }

        .main-nav ul {
            list-style: none;
            margin: 0;
            padding: 0;
            display: flex;
            gap: 20px;
            justify-content: center;
            align-items: center;
        }

        .main-nav ul li a {
            color: white;
            text-decoration: none;
            padding: 8px 16px;
            border-radius: 6px;
            background-color: #2c3e50;
            transition: background-color 0.3s ease, transform 0.2s ease;
            display: flex;
            align-items: center;
            gap: 6px;
            font-weight: 500;
        }

        .main-nav ul li a:hover {
            background-color: #1abc9c;
            transform: translateY(-2px);
        }

        .main-content {
            display: flex;
            flex: 1;
        }
        .sidebar {
            width: 320px;
            background-color: #ecf0f1;
            padding: 10px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        .content {
            flex: 1;
            padding: 10px;
            display: flex;
            flex-direction: column;
        }
        .status-bar {
            flex: 1;
            max-height: 300px; /* æ·»åŠ é™åˆ¶é«˜åº¦ */
            overflow-y: auto;  /* æ·»åŠ æ»šåŠ¨æ¡ */
            background-color: #a3a9a9;
            color: white;
            padding: 10px;
            text-align: center;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .status-section {
            background-color: #f6f8fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border: 1px solid #e1e4e8;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .status-section h3 {
            margin: 0 0 10px 0;
            color: #24292e;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .status-section h3::before {
            font-family: "Font Awesome 5 Free";
            font-weight: 900;
        }
        .status-section h3[data-status="focus"]::before {
            content: "ğŸ¯";
            color: #28a745;
        }
        .status-section h3[data-status="upcoming"]::before {
            content: "ğŸ“…";
            color: #0366d6;
        }
        .status-section h3[data-status="completed"]::before {
            content: "âœ…";
            color: #6f42c1;
        }
        .task-list {
            list-style-type: none;
            padding: 0;
            margin: 0;
        }
        .task-list li {
            background-color: #fff;
            padding: 10px;
            margin-bottom: 8px;
            border: 1px solid #e1e4e8;
            border-radius: 6px;
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: move;
            transition: all 0.2s ease;
        }
        .task-list li:hover {
            background-color: #f1f8ff;
            border-color: #0366d6;
        }
        .task-list li .task-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 4px;
        }
        .task-list li .task-title {
            font-weight: 500;
            color: #24292e;
        }
        .task-list li .task-meta {
            display: flex;
            gap: 8px;
            font-size: 12px;
            color: #586069;
        }
        .task-tag {
            padding: 2px 6px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 500;
        }
        .task-tag.high {
            background-color: #ffdce0;
            color: #cb2431;
        }
        .task-tag.medium {
            background-color: #fff3c2;
            color: #b08800;
        }
        .task-tag.low {
            background-color: #e1f0ff;
            color: #0366d6;
        }
        .task-progress {
            height: 4px;
            background-color: #eee;
            border-radius: 2px;
            overflow: hidden;
            margin-top: 4px;
        }
        .task-progress-bar {
            height: 100%;
            background-color: #28a745;
            transition: width 0.3s ease;
        }
        .task-actions {
            display: flex;
            gap: 4px;
            flex-shrink: 0;
        }
        .task-actions button {
            width: 28px;
            height: 28px;
            padding: 0;
            border: 1px solid #e1e4e8;
            border-radius: 4px;
            background-color: #fafbfc;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }
        .task-actions button i {
            font-size: 12px;
        }
        .task-actions button::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: -25px;
            left: 50%;
            transform: translateX(-50%);
            padding: 4px 8px;
            background-color: #24292e;
            color: white;
            border-radius: 4px;
            font-size: 12px;
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            transition: all 0.2s ease;
            z-index: 1000;
        }
        .task-actions button:hover::after {
            opacity: 1;
            visibility: visible;
        }
        .task-actions button.edit {
            color: #0366d6;
            border-color: #0366d6;
        }
        .task-actions button.edit:hover {
            background-color: #0366d6;
            color: white;
        }
        .task-actions button.move {
            color: #28a745;
            border-color: #28a745;
        }
        .task-actions button.move:hover {
            background-color: #28a745;
            color: white;
        }
        .task-actions button.progress {
            color: #6f42c1;
            border-color: #6f42c1;
        }
        .task-actions button.progress:hover {
            background-color: #6f42c1;
            color: white;
        }
        .task-actions button.delete {
            color: #cb2431;
            border-color: #cb2431;
        }
        .task-actions button.delete:hover {
            background-color: #cb2431;
            color: white;
        }
        .add-task-container {
            margin-bottom: 15px;
            padding: 15px;
            background-color: #f6f8fa;
            border: 1px solid #e1e4e8;
            border-radius: 6px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .add-task-container .form-row {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        .add-task-container select,
        .add-task-container input[type="text"] {
            padding: 6px 8px;
            border: 1px solid #e1e4e8;
            border-radius: 4px;
            font-size: 14px;
        }
        .add-task-container input[type="text"] {
            flex: 1;
        }
        .add-task-container button {
            padding: 8px 16px;
            background-color: #2ea44f;
            color: white;
            border: 1px solid rgba(27,31,35,0.15);
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .add-task-container button i {
            font-size: 16px;
        }
        .add-task-container button:hover {
            background-color: #2c974b;
            transform: translateY(-1px);
        }
        .group-section {
            margin-bottom: 0px;
        }
        .group-section h2 {
            margin-top: 0;
        }
        .roomlist {
            background-color: #ecf0f1;
            padding: 10px;
            border-radius: 5px;
            height: 150px; /* å›ºå®šé«˜åº¦ */
            width: 880px;
            overflow-y: auto; /* æ·»åŠ å‚ç›´æ»šåŠ¨ */
            margin-bottom: 10px; /* ä¸ä¸‹æ–¹å†…å®¹é—´éš” */
        }
        .courseware-section {
            flex: 1;
            display: flex;
            flex-direction: column;
            max-height: 950px;
            gap: 10px;
        }
        .courseware-content {
            background-color: #ecf0f1;
            padding: 10px;
            border-radius: 5px;
            flex: 1;
            max-height: 800px;
            overflow-y: auto;
        }
        .add-task {
            display: flex;
            gap: 10px;
        }
        .add-task input {
            flex: 1;
            padding: 5px;
        }
        .add-task button {
            padding: 5px 10px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 3px;
            cursor: pointer;
        }
        .add-task button:hover {
            background-color: #2980b9;
        }
        /* æ–°å¢çš„æˆ¿é—´é€‰æ‹©æ ·å¼ */
        .room-form {
            margin: 0 auto 15px auto;
            padding: 10px;
            background-color: #d6dbdf;
            border-radius: 5px;
            box-sizing: border-box;    /* é˜²æ­¢ padding æ’‘å¤§ */
        }
        .room-form h4 {
            margin-top: 0;
            margin-bottom: 10px;
        }
        .room-form input[type="text"] {
            width: 96%;
            padding: 5px;
            margin-bottom: 8px;
            border: 1px solid #ccc;
            border-radius: 3px;
        }
        .room-form button {
            width: 100%;
            padding: 5px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 3px;
            cursor: pointer;
        }
        .room-form button:hover {
            background-color: #2980b9;
        }
        .messages {
            margin-bottom: 10px;
            font-size: 14px;
        }
        .messages .error {
            color: #e74c3c;
        }
        .messages .success {
            color: #27ae60;
        }
        .add-task-container {
            display: flex;
            gap: 10px;
            margin-top: 1px; /* åŸæ¥å¦‚æœæ˜¯é»˜è®¤çš„ 20+ å°±å¤ªå¤§äº† */
        }
         .add-task-container select,
        .add-task-container input[type="text"],
        .add-task-container button {
            padding: 5px;
            border: 1px solid #ccc;
            border-radius: 3px;
        }
        .add-task-container button {
            background-color: #3498db;
            color: white;
            cursor: pointer;
        }
        .add-task-container button:hover {
            background-color: #2980b9;
        }
        .pdf-gallery {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            padding: 20px;
            max-height: 600px;
            overflow-y: auto;
            height: calc(100vh - 60px); /* å‡å» header çš„é«˜åº¦ */
        }

        .pdf-item {
            width: 200px;
            text-align: center;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
            overflow: hidden;
        }

        .pdf-item img {
            width: 100%;
            height: auto;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .pdf-item:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 12px rgba(0, 0, 0, 0.2);
        }

        .pdf-title {
            margin-top: 10px;
            font-size: 16px;
            font-weight: bold;
            color: #333;
        }
        .pdf-controls {
            max-height: 130px;         /* é™åˆ¶æ•´ä½“é«˜åº¦ */
            position: absolute;
            top: 130px;         /* æ ¹æ® header + nav é«˜åº¦å¾®è°ƒ */
            right: 30px;       /* é å³ä¸€ç‚¹ */
            background: #f8f9fa;
            padding: 12px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            z-index: 999;
            display: flex;
            flex-direction: column;
            gap: 10px;
            max-width: 500px;
        }
        .modal {
            display: none;
            position: fixed;
            z-index: 9999;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
        }

        .modal-content {
            background-color: #f8f9fa;
            padding: 20px;
            border: 1px solid #888;
            width: 100%;
            max-width: 800px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            max-height: 70vh; /* é™åˆ¶é«˜åº¦ä¸ºè§†å£çš„70% */
            overflow-y: auto;
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover {
            color: black;
        }

        .module-section {
            margin-bottom: 15px;
            padding: 10px;
            background-color: white;
            border-radius: 5px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .module-section h3 {
            margin-top: 0;
            color: #2c3e50;
            border-bottom: 1px solid #eee;
            padding-bottom: 5px;
        }
        /* ç®€æ´æˆ¿é—´åˆ—è¡¨æ ·å¼ */
        .compact-room-list {
            margin-top: 10px;
            max-height: calc(100% - 30px); /* å‡å»æ ‡é¢˜é«˜åº¦ */
            overflow-y: auto;
        }
        .room-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            align-content: flex-start; /* é¡¶éƒ¨å¯¹é½ */
            min-height: 20px; /* æœ€å°é«˜åº¦ */
        }
        .room-tag {
            padding: 5px 10px;
            background-color: #e0e0e0;
            border-radius: 15px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
        }
        .room-tag:hover {
            background-color: #3498db;
            color: white;
        }
        .room-tag.my-room {
            background-color: #2ecc71;
            color: white;
        }
        .room-tag.joined-room {
            background-color: #f39c12;
            color: white;
        }
        .task-edit-modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            z-index: 1000;
            display: none;
        }

        .task-edit-modal.show {
            display: block;
        }

        .modal-backdrop {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 999;
            display: none;
        }

        .modal-backdrop.show {
            display: block;
        }

        .task-edit-modal button {
            width: 36px;
            height: 36px;
            padding: 0;
            border-radius: 50%;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .task-edit-modal button i {
            font-size: 16px;
        }

        .task-edit-modal button::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: -30px;
            left: 50%;
            transform: translateX(-50%);
            padding: 4px 8px;
            background-color: #24292e;
            color: white;
            border-radius: 4px;
            font-size: 12px;
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            transition: all 0.2s ease;
        }

        .task-edit-modal button:hover::after {
            opacity: 1;
            visibility: visible;
        }

        .task-edit-modal button.save {
            background-color: #2ea44f;
            color: white;
            border: none;
            margin-right: 10px;
        }

        .task-edit-modal button.save:hover {
            background-color: #2c974b;
            transform: translateY(-2px);
            box-shadow: 0 2px 4px rgba(46, 164, 79, 0.2);
        }

        .task-edit-modal button.cancel {
            background-color: #fafbfc;
            color: #24292e;
            border: 1px solid #e1e4e8;
        }

        .task-edit-modal button.cancel:hover {
            background-color: #f3f4f6;
            transform: translateY(-2px);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .task-edit-modal .button-group {
            display: flex;
            justify-content: center;
            margin-top: 20px;
        }
        h2.module-title, h3.module-title, h4.module-title {
            margin: 10px 0 15px 0;
            padding: 10px 15px;
            background-color: #d6dbdf;
            color: #2c3e50;
            font-size: 18px;
            border-left: 5px solid #3498db;
            border-radius: 4px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

    </style>
</head>
<body>
    <header class="header-bar">
        <h1><i class="fas fa-book-open"></i> Lesson Page</h1>
    </header>
    <nav class="main-nav">
        <ul>
            <li><a href="/login/IDE">Go Back</a></li>
            <li><a href="/login/IDE/{{ data_course }}/self-learn/">Self-Learn</a></li>
        </ul>
    </nav>
    <div class="main-content">
        <div class="sidebar">
            <div class="group-section">
                <h2 class="module-title">å°ç»„å­¦ä¹ </h2>

                <!-- æˆ¿é—´é€‰æ‹©åŠŸèƒ½ -->
                <div id="message" class="messages"></div>

                <div class="room-form">
                    <h4>åˆ›å»ºæˆ¿é—´</h4>
                    <form id="create-room-form" method="POST" action="{% url 'lesson:create_room' data_course=data_course%}">
                        {% csrf_token %}
                        <input type="text" name="room_name" placeholder="è¾“å…¥æˆ¿é—´åç§°ï¼ˆå¯åŒ…å«å­—æ¯å’Œæ•°å­—ï¼‰" required>
                        <button type="submit">åˆ›å»ºæˆ¿é—´</button>
                    </form>
                </div>

                <div class="room-form">
                    <h4>åŠ å…¥æˆ¿é—´</h4>
                    <form id="join-room-form" method="POST" action="{% url 'lesson:join_room' data_course=data_course%}">
                        {% csrf_token %}
                        <input type="text" name="room_name" placeholder="è¾“å…¥æˆ¿é—´åç§°" required>
                        <button type="submit">åŠ å…¥æˆ¿é—´</button>
                    </form>
                </div>

                <div class="room-form">
                    <h4>åˆ é™¤æˆ¿é—´</h4>
                    <form id="delete-room-form" method="POST" action="">
                        {% csrf_token %}
                        <input type="text" name="room_name" placeholder="è¾“å…¥æˆ¿é—´åç§°" required>
                        <button type="submit">åˆ é™¤æˆ¿é—´</button>
                    </form>
                </div>
            </div>


                <!-- æ·»åŠ ä»»åŠ¡çš„è¾“å…¥æ¡† -->
        <h2 class="module-title">ä»»åŠ¡æ </h2>
        <div class="add-task-container">
            <div class="form-row">
                <input type="text" id="new-task-input" placeholder="æ·»åŠ ä»»åŠ¡">
            </div>
            <div class="form-row">
                <select id="task-priority">
                    <option value="high">ğŸ”´ é«˜ä¼˜å…ˆçº§</option>
                    <option value="medium">ğŸŸ¡ ä¸­ä¼˜å…ˆçº§</option>
                    <option value="low">ğŸ”µ ä½ä¼˜å…ˆçº§</option>
                </select>
                <select id="task-section">
                    <option value="focus-list">ğŸ¯ å…³æ³¨</option>
                    <option value="upcoming-list">ğŸ“… å³å°†</option>
                    <option value="completed-list">âœ… å®Œæˆ</option>
                </select>
            </div>
             <button onclick="addTask()"><i class="fas fa-plus"></i> æ·»åŠ ä»»åŠ¡</button>
        </div>


        <div class="status-bar">
            <!-- å…³æ³¨ -->
            <div class="status-section">
                <h3 data-status="focus">å…³æ³¨ focus</h3>
                <ul class="task-list" id="focus-list"></ul>
            </div>
            <!-- å³å°† -->
            <div class="status-section">
                <h3 data-status="upcoming">å³å°† upcoming</h3>
                <ul class="task-list" id="upcoming-list"></ul>
            </div>
            <!-- å®Œæˆ -->
            <div class="status-section">
                <h3 data-status="completed">å®Œæˆ completed</h3>
                <ul class="task-list" id="completed-list"></ul>
            </div>
        </div>

        </div>
        <div class="content">
            <div class="courseware-section">
                <div class="pdf-controls">
                    <!-- ä¿®æ”¹ PDF ä¸Šä¼ æŒ‰é’® -->
                    <div class="pdf-upload-btn">
                        <h4 class="module-title">ğŸŒŸä¸Šä¼ /åˆ é™¤PDFğŸŒŸ</h4>
                        <form id="pdf-upload-form" method="POST" enctype="multipart/form-data" action="/login/IDE/{{ data_course }}/self-learn/upload_pdf/">
                            {% csrf_token %}
                            <input type="file" name="pdf" accept=".pdf" required>
                            <button type="submit">ä¸Šä¼ PDF</button>
                        </form>
                    </div>

                    <div>
{#                        <h4>åˆ é™¤PDF</h4>#}
                        <select id="delete-pdf-select" style="padding: 5px; border-radius: 3px; width: 210px;"></select>
                        <button onclick="deleteSelectedPdf()" style="padding: 5px 10px; margin-left: 10px;">åˆ é™¤æ‰€é€‰PDF</button>
                    </div>
                </div>
                <div class="roomlist">
                    <h3 class="module-title">æˆ¿é—´åˆ—è¡¨</h3>
                    <div id="room-list-container" class="compact-room-list">
                        <div id="room-list" class="room-tags"></div>
                    </div>
                </div>
                <div class="courseware-content">
                    <h3 class="module-title">è¯¾ä»¶å†…å®¹</h3>
                    <div class="pdf-gallery" id="pdf-gallery">
                        <!-- PDF å±•ç¤ºåŒºåŸŸ -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="moduleModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>IDEä½¿ç”¨æŒ‡å—</h2>

            <div class="module-section">
                <h3>å¯¼èˆªæ </h3>
                <p>ç‚¹å‡»self-learnè¿›å…¥ä¸ªäººå·¥ä½œå°ï¼Œå¯¹ä¸Šä¼ çš„pdfè¿›è¡Œæ‰¹æ³¨ã€è®°ç¬”è®°ã€æ‰§è¡Œä»£ç </p>
            </div>

            <div class="module-section">
                <h3>å°ç»„å­¦ä¹ </h3>
                <p>æä¾›åˆ›å»ºã€åŠ å…¥å’Œåˆ é™¤å­¦ä¹ æˆ¿é—´çš„åŠŸèƒ½ï¼Œç‚¹å‡»åŠ å…¥æˆ¿é—´åè¿›å…¥å°ç»„åä½œå­¦ä¹ é¡µé¢</p>
            </div>

            <div class="module-section">
                <h3>ä»»åŠ¡ç®¡ç†</h3>
                <p>åˆ†ä¸ºä¸‰ä¸ªçŠ¶æ€ï¼šå…³æ³¨(focus)ã€å³å°†(upcoming)ã€å®Œæˆ(completed)</p>
                <p>å¯ä»¥æ·»åŠ ã€åˆ é™¤å’Œç§»åŠ¨ä»»åŠ¡</p>
            </div>

            <div class="module-section">
                <h3>è¯¾ä»¶å†…å®¹</h3>
                <p>æ˜¾ç¤ºä¸Šä¼ çš„PDFæ–‡ä»¶ï¼Œç‚¹å‡»ç›¸åº”æ–‡ä»¶å¯è¿›å…¥ä¸ªäººå·¥ä½œå°ç•Œé¢å¼€å§‹å­¦ä¹ </p>
                <p>åº•éƒ¨æä¾›PDFä¸Šä¼ åŠŸèƒ½</p>
            </div>

            <div style="margin-top: 15px;">
                <label>
                    <input type="checkbox" id="dontShowAgain">
                    ä¸å†æ˜¾ç¤ºæ­¤æç¤º
                </label>
            </div>
        </div>
    </div>

    <script>
        
        function addTask() {
            const taskText = document.getElementById('new-task-input').value.trim();
            const priority = document.getElementById('task-priority').value;
            const section = document.getElementById('task-section').value;
            
            if (taskText) {
                const list = document.getElementById(section);
                const li = createTaskItem(taskText, priority);
                list.appendChild(li);
                document.getElementById('new-task-input').value = '';
            }
        }

        // æˆ¿é—´åå­—éªŒè¯
        document.getElementById('create-room-form').addEventListener('submit', function(e) {
            const roomName = this.querySelector('input[name="room_name"]').value;
            if (!/^[a-zA-Z0-9_-]+$/.test(roomName)) {
                document.getElementById('message').innerHTML = 
                    '<div class="error">æˆ¿é—´åç§°åªèƒ½åŒ…å«å­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿å’Œè¿å­—ç¬¦</div>';
                e.preventDefault();
                return;
            }
        });

        document.getElementById('create-room-form').addEventListener('submit', function (e) {
            e.preventDefault();
            const formData = new FormData(this);

            fetch("{% url 'lesson:create_room' data_course=data_course%}", {
                method: 'POST',
                body: formData,
                headers: {
                    'X-CSRFToken': formData.get('csrfmiddlewaretoken')
                }
            })
            .then(response => response.json())
            .then(data => {
                console.log("Server response:", '/login/IDE/{{ data_course }}/group-' + encodeURIComponent(data.room_id));
                if (data.status === 'success') {
                    document.getElementById('message').innerHTML =
                        `<div class="success">æˆ¿é—´åˆ›å»ºæˆåŠŸï¼æˆ¿é—´å·: {{ room_name }}</div>`;
                        window.location.href = '/login/IDE/{{ data_course }}/group-' + encodeURIComponent(data.room_id);
                } else {
                    document.getElementById('message').innerHTML =
                        `<div class="error">${data.message}</div>`;
                }
            })
            .catch(error => {
                console.error('Error:', error);
            });
        });

        // å¤„ç†åŠ å…¥æˆ¿é—´è¡¨å•æäº¤
        document.getElementById('join-room-form').addEventListener('submit', function (e) {
            e.preventDefault();
            const formData = new FormData(this);

            fetch("{% url 'lesson:join_room' data_course=data_course%}", {
                method: 'POST',
                body: formData,
                headers: {
                    'X-CSRFToken': formData.get('csrfmiddlewaretoken')
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    window.location.href = `/login/IDE/{{ data_course }}/group-${data.room_name}`;
                } else {
                    document.getElementById('message').innerHTML = `<div class="error">${data.message}</div>`;
                }
            })
            .catch(error => {
                console.error('Error:', error);
            });
        });

        // å¤„ç†åˆ é™¤æˆ¿é—´è¡¨å•æäº¤
        document.getElementById('delete-room-form').addEventListener('submit', function (e) {
            e.preventDefault();
            const formData = new FormData(this);
            const roomName = formData.get('room_name');

            const deleteUrl = `/login/IDE/{{ data_course }}/delete-room/group-${roomName}/`;  // delete-room

            fetch(deleteUrl, {
                method: 'POST',
                body: formData,
                headers: {
                    'X-CSRFToken': formData.get('csrfmiddlewaretoken')
                }
            })
            .then(response => {
                if (response.status === 200) {
                    document.getElementById('message').innerHTML = `<div class="success">æˆ¿é—´åˆ é™¤æˆåŠŸï¼</div>`;
                } else {
                    document.getElementById('message').innerHTML = `<div class="error">ä½ æ— æ³•åˆ é™¤è¯¥æˆ¿é—´ï¼</div>`;
                }
            })
            .catch(error => {
                console.error('Error:', error);
            });
        });

        async function loadRoomList() {
            try {
                const response = await fetch('/login/IDE/{{ data_course }}/get-room/');
                const data = await response.json();
                console.log('æˆ¿é—´åˆ—è¡¨:', data);
                
                if(data.status === 'success') {
                    renderCompactRoomList(data.rooms);
                } else {
                    console.error('Error:', data.message);
                }
            } catch (error) {
                console.error('è·å–æˆ¿é—´åˆ—è¡¨å¤±è´¥:', error);
            }
        }

        function renderCompactRoomList(rooms) {
            const roomList = document.getElementById('room-list');
            roomList.innerHTML = '';
            
            if(rooms.length === 0) {
                roomList.innerHTML = '<div class="no-rooms">æš‚æ— æˆ¿é—´</div>';
                return;
            }
            
            rooms.forEach(room => {
                const tag = document.createElement('div');
                tag.className = 'room-tag';
                tag.textContent = room.name;
                
                // æ·»åŠ çŠ¶æ€ç±»
                if(room.is_creator) {
                    tag.classList.add('my-room');
                    tag.title = "æˆ‘åˆ›å»ºçš„æˆ¿é—´";
                } else if(room.is_member) {
                    tag.classList.add('joined-room');
                    tag.title = "å·²åŠ å…¥çš„æˆ¿é—´";
                }
                
                // ç‚¹å‡»äº‹ä»¶ - å¡«å……åˆ°åŠ å…¥æˆ¿é—´è¡¨å•
                tag.addEventListener('click', () => {
                    document.querySelector('#join-room-form input[name="room_name"]').value = room.name;
                });
                
                roomList.appendChild(tag);
            });
        }

        // é¡µé¢åŠ è½½æ—¶è·å–æˆ¿é—´åˆ—è¡¨
        document.addEventListener('DOMContentLoaded', loadRoomList);




        async function populateDeletePdfDropdown() {
    const response = await fetch('/login/IDE/{{ data_course }}/self-learn/get_pdf_list/');
    const data = await response.json();
    const select = document.getElementById('delete-pdf-select');

    select.innerHTML = ''; // æ¸…ç©ºæ—§é€‰é¡¹

    data.pdfs.forEach(pdf => {
        const option = document.createElement('option');
        option.value = pdf;
        option.textContent = pdf;
        select.appendChild(option);
    });
}

        // åˆ é™¤é€‰ä¸­çš„ PDF
        async function deleteSelectedPdf() {
            const select = document.getElementById('delete-pdf-select');
            const pdfName = select.value;

            if (!pdfName) {
                alert("è¯·é€‰æ‹©ä¸€ä¸ª PDF æ–‡ä»¶");
                return;
            }

            const confirmed = confirm(`ç¡®å®šåˆ é™¤ ${pdfName} å—ï¼Ÿ`);
            if (!confirmed) return;

            const response = await fetch('/login/IDE/{{ data_course }}/self-learn/delete_pdf/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': '{{ csrf_token }}',
                },
                body: JSON.stringify({ pdf_name: pdfName })
            });

            if (response.ok) {
                alert("åˆ é™¤æˆåŠŸ");
                await loadPdfGallery();           // åˆ·æ–°å±•ç¤º
                await populateDeletePdfDropdown(); // åˆ·æ–°ä¸‹æ‹‰åˆ—è¡¨
            } else {
                alert("åˆ é™¤å¤±è´¥");
            }
        }

// é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨å¡«å……
document.addEventListener('DOMContentLoaded', populateDeletePdfDropdown);


        async function loadPdfGallery() {
            const response = await fetch('/login/IDE/{{ data_course }}/self-learn/get_pdf_list/');
            const data = await response.json();
            const pdfGallery = document.getElementById('pdf-gallery');

            pdfGallery.innerHTML = ''; // æ¸…ç©ºä¹‹å‰çš„å†…å®¹

            data.pdfs.forEach(pdf => {
                const pdfName = pdf.split('.pdf')[0]; // å»æ‰æ‰©å±•å
                const encodedPdfName = encodeURIComponent(pdfName); // ç¼–ç æ–‡ä»¶å
                const thumbnailUrl = `/media/pdf_images/${encodedPdfName}_page_1.jpg`; // ç¬¬ä¸€é¡µç¼©ç•¥å›¾è·¯å¾„

                // åˆ›å»º PDF å±•ç¤ºé¡¹
                const pdfItem = document.createElement('div');
                pdfItem.className = 'pdf-item';
                pdfItem.dataset.pdfName = pdf; // å­˜å‚¨ PDF æ–‡ä»¶å

                pdfItem.innerHTML = `
                    <img src="${thumbnailUrl}" alt="${pdfName}" onerror="this.src='/static/images/default-thumbnail.jpg';">
                    <div class="pdf-title">${pdfName}</div>
                `;

                // åŒå‡»äº‹ä»¶ï¼šè·³è½¬åˆ° self-learn ç•Œé¢
                pdfItem.ondblclick = () => {
                    const url = `/login/IDE/{{ data_course }}/self-learn/pdf/viewer/?pdf_name=${encodeURIComponent(pdf)}`;
                    window.location.href = url;
                };

                pdfGallery.appendChild(pdfItem);
            });
        }

        // åŠ è½½ PDF å±•ç¤º
        loadPdfGallery();
    </script>
<script>
    document.getElementById('pdf-upload-form').addEventListener('submit', async function (e) {
        e.preventDefault(); // é˜»æ­¢é»˜è®¤è¡¨å•æäº¤è¡Œä¸º

        const formData = new FormData(this);
        const response = await fetch('/login/IDE/{{ data_course }}/self-learn/upload_pdf/', {
            method: 'POST',
            body: formData,
        });

        if (response.ok) {
            const data = await response.json();
            alert(data.message || 'PDF ä¸Šä¼ æˆåŠŸï¼');
            location.reload(); // ä¸Šä¼ æˆåŠŸååˆ·æ–°é¡µé¢
        } else {
            const errorData = await response.json();
            alert(errorData.error || 'PDF ä¸Šä¼ å¤±è´¥ï¼');
        }
    });

    document.addEventListener('DOMContentLoaded', function() {
        if (!localStorage.getItem('hasSeenModal')) {
            const modal = document.getElementById('moduleModal');
            modal.style.display = 'block';
            
            document.querySelector('.close').onclick = function() {
                if (document.getElementById('dontShowAgain').checked) {
                    localStorage.setItem('hasSeenModal', 'true'); // å‹¾é€‰åä¸å†æ˜¾ç¤º
                }
                modal.style.display = 'none';
            };
            
            window.onclick = function(event) {
                if (event.target === modal) {
                    if (document.getElementById('dontShowAgain').checked) {
                        localStorage.setItem('hasSeenModal', 'true');
                    }
                    modal.style.display = 'none';
                }
            };
        }
    });
</script>

<script>
    
        // åˆ›å»ºä»»åŠ¡é¡¹
        /*
     * AI-generated-content
     * tool:Hunyuan
     * version: latest
     * usage: I used the prompt "åˆ›å»ºä»»åŠ¡é¡¹ï¼Œå¯ä»¥ç§»åŠ¨åˆ°å…¶ä»–çŠ¶æ€å’Œåˆ é™¤", and
     * use the framework it provides, but modify some of the details
        */
        function createTaskItem(taskText, priority) {
            const li = document.createElement('li');
            li.setAttribute('draggable', 'true');
            
            // åˆ›å»ºä»»åŠ¡å†…å®¹å®¹å™¨
            const taskContent = document.createElement('div');
            taskContent.className = 'task-content';
            
            // ä»»åŠ¡æ ‡é¢˜
            const taskTitle = document.createElement('div');
            taskTitle.className = 'task-title';
            taskTitle.textContent = taskText;
            
            // ä»»åŠ¡å…ƒæ•°æ®
            const taskMeta = document.createElement('div');
            taskMeta.className = 'task-meta';
            
            // æ·»åŠ ä¼˜å…ˆçº§æ ‡ç­¾
            const priorityTag = document.createElement('span');
            priorityTag.className = `task-tag ${priority}`;
            priorityTag.textContent = `${priority} priority`;
            taskMeta.appendChild(priorityTag);
            
            // æ·»åŠ åˆ›å»ºæ—¥æœŸ
            const dateSpan = document.createElement('span');
            dateSpan.textContent = new Date().toLocaleDateString();
            taskMeta.appendChild(dateSpan);
            
            // æ·»åŠ è¿›åº¦æ¡
            const progress = document.createElement('div');
            progress.className = 'task-progress';
            const progressBar = document.createElement('div');
            progressBar.className = 'task-progress-bar';
            progressBar.style.width = '0%';
            progress.appendChild(progressBar);
            
            // ç»„è£…ä»»åŠ¡å†…å®¹
            taskContent.appendChild(taskTitle);
            taskContent.appendChild(taskMeta);
            taskContent.appendChild(progress);
            
            // åˆ›å»ºæ“ä½œæŒ‰é’®å®¹å™¨
            const actions = document.createElement('div');
            actions.className = 'task-actions';
            
            // ç¼–è¾‘æŒ‰é’®
            const editButton = document.createElement('button');
            editButton.className = 'edit';
            editButton.innerHTML = '<i class="fas fa-edit"></i>';
            editButton.setAttribute('data-tooltip', 'ç¼–è¾‘');
            editButton.onclick = (e) => {
                e.stopPropagation();
                openTaskEdit(li, taskText, priority);
            };
            
            // ç§»åŠ¨æŒ‰é’®
            const moveButton = document.createElement('button');
            moveButton.className = 'move';
            moveButton.innerHTML = '<i class="fas fa-arrows-alt"></i>';
            moveButton.setAttribute('data-tooltip', 'ç§»åŠ¨');
            moveButton.onclick = (e) => {
                e.stopPropagation();
                showMoveOptions(li);
            };
            
            // æ›´æ–°è¿›åº¦æŒ‰é’®
            const progressButton = document.createElement('button');
            progressButton.className = 'progress';
            progressButton.innerHTML = '<i class="fas fa-tasks"></i>';
            progressButton.setAttribute('data-tooltip', 'æ›´æ–°è¿›åº¦');
            progressButton.onclick = (e) => {
                e.stopPropagation();
                const currentProgress = parseInt(progressBar.style.width) || 0;
                const newProgress = Math.min(100, currentProgress + 20);
                progressBar.style.width = `${newProgress}%`;
                if (newProgress === 100) {
                    moveTask(li, document.getElementById('completed-list'));
                }
            };
            
            // åˆ é™¤æŒ‰é’®
            const deleteButton = document.createElement('button');
            deleteButton.className = 'delete';
            deleteButton.innerHTML = '<i class="fas fa-trash-alt"></i>';
            deleteButton.setAttribute('data-tooltip', 'åˆ é™¤');
            deleteButton.onclick = (e) => {
                e.stopPropagation();
                deleteTask(li);
            };
            
            actions.appendChild(editButton);
            actions.appendChild(moveButton);
            actions.appendChild(progressButton);
            actions.appendChild(deleteButton);
            
            // ç»„è£…ä»»åŠ¡é¡¹
            li.appendChild(taskContent);
            li.appendChild(actions);
            
            // æ·»åŠ æ‹–æ‹½äº‹ä»¶
            li.addEventListener('dragstart', (e) => {
                e.dataTransfer.setData('text/plain', taskText);
                li.classList.add('dragging');
            });
            
            li.addEventListener('dragend', () => {
                li.classList.remove('dragging');
            });
            
            return li;
        }

        // åˆ é™¤ä»»åŠ¡
        function deleteTask(taskItem) {
            const parentList = taskItem.parentElement;
            parentList.removeChild(taskItem);
        }

        // æ˜¾ç¤ºç§»åŠ¨é€‰é¡¹
        function showMoveOptions(taskItem) {
            const currentList = taskItem.parentElement;
            const allLists = document.querySelectorAll('.task-list');

            // åˆ›å»ºä¸€ä¸ªä¸´æ—¶èœå•
            const menu = document.createElement('div');
            menu.className = 'move-menu';
            menu.style.position = 'absolute';
            menu.style.border = '1px solid #ccc';
            menu.style.backgroundColor = 'white';
            menu.style.padding = '5px';
            menu.style.zIndex = '1000';

            // æ·»åŠ "ç§»åŠ¨åˆ°"é€‰é¡¹
            allLists.forEach((list) => {
                if (list !== currentList) {
                    const option = document.createElement('div');
                    option.textContent = list.id.replace('-list', ''); // è·å–çŠ¶æ€åç§°
                    option.onclick = () => moveTask(taskItem, list,menu);
                    menu.appendChild(option);
                }
            });

            // æ·»åŠ å…³é—­é€‰é¡¹
            const closeButton = document.createElement('div');
            closeButton.textContent = 'å…³é—­';
            closeButton.onclick = () => menu.remove();
            menu.appendChild(closeButton);

            // å°†èœå•æ·»åŠ åˆ°é¡µé¢
            document.body.appendChild(menu);

           // è·å–é¼ æ ‡ç‚¹å‡»ä½ç½®ï¼ˆæ¨èæ–¹å¼ï¼‰
            const clickEvent = new MouseEvent('click'); // åˆ›å»ºä¸€ä¸ªæ¨¡æ‹Ÿçš„é¼ æ ‡äº‹ä»¶
            taskItem.dispatchEvent(clickEvent); // è§¦å‘ç‚¹å‡»äº‹ä»¶ä»¥è·å–åæ ‡ï¼ˆä»…é€‚ç”¨äºæŸäº›åœºæ™¯ï¼‰
            // æˆ–è€…ç›´æ¥ä½¿ç”¨é¼ æ ‡äº‹ä»¶çš„ clientX å’Œ clientYï¼ˆæ¨èï¼‰
            // ä½ éœ€è¦å°†ç‚¹å‡»äº‹ä»¶çš„åæ ‡ä¼ é€’ç»™ showMoveOptions å‡½æ•°
        
            // å¦‚æœä½ æœ‰é¼ æ ‡ç‚¹å‡»äº‹ä»¶çš„åæ ‡ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ï¼š
            // const { clientX, clientY } = mouseClickEvent;
        
            // å¦‚æœæ²¡æœ‰é¼ æ ‡äº‹ä»¶åæ ‡ï¼Œä½¿ç”¨ getBoundingClientRect() å¹¶ä¿®æ­£æ»šåŠ¨åç§»
            const rect = taskItem.getBoundingClientRect();
            const scrollX = window.scrollX || window.pageXOffset;
            const scrollY = window.scrollY || window.pageYOffset;
        
            menu.style.left = `${rect.left + scrollX}px`; // ä¿®æ­£æ°´å¹³ä½ç½®
            menu.style.top = `${rect.bottom + scrollY + 5}px`; // ä¿®æ­£å‚ç›´ä½ç½®
        }

        // ç§»åŠ¨ä»»åŠ¡
        function moveTask(taskItem, targetList,menu) {
            targetList.appendChild(taskItem); // å°†ä»»åŠ¡é¡¹ç§»åŠ¨åˆ°ç›®æ ‡åˆ—è¡¨
            menu.remove();
        }

        // åˆå§‹åŒ–æ‹–æ‹½åŠŸèƒ½
        document.querySelectorAll('.task-list').forEach(list => {
            list.addEventListener('dragover', (e) => {
                e.preventDefault();
                const draggingItem = document.querySelector('.dragging');
                if (draggingItem) {
                    const afterElement = getDragAfterElement(list, e.clientY);
                    if (afterElement) {
                        list.insertBefore(draggingItem, afterElement);
                    } else {
                        list.appendChild(draggingItem);
                    }
                }
            });
        });

        function getDragAfterElement(container, y) {
            const draggableElements = [...container.querySelectorAll('li:not(.dragging)')];
            return draggableElements.reduce((closest, child) => {
                const box = child.getBoundingClientRect();
                const offset = y - box.top - box.height / 2;
                if (offset < 0 && offset > closest.offset) {
                    return { offset: offset, element: child };
                } else {
                    return closest;
                }
            }, { offset: Number.NEGATIVE_INFINITY }).element;
        }

        let currentEditingTask = null;

        function openTaskEdit(taskItem, taskText, priority) {
            currentEditingTask = taskItem;
            const modal = document.getElementById('task-edit-modal');
            const backdrop = document.getElementById('modal-backdrop');
            const input = document.getElementById('edit-task-input');
            const prioritySelect = document.getElementById('edit-task-priority');
            
            input.value = taskText;
            prioritySelect.value = priority;
            
            modal.classList.add('show');
            backdrop.classList.add('show');
        }

        function closeTaskEdit() {
            const modal = document.getElementById('task-edit-modal');
            const backdrop = document.getElementById('modal-backdrop');
            
            modal.classList.remove('show');
            backdrop.classList.remove('show');
            currentEditingTask = null;
        }

        function saveTaskEdit() {
            if (!currentEditingTask) return;
            
            const newText = document.getElementById('edit-task-input').value.trim();
            const newPriority = document.getElementById('edit-task-priority').value;
            
            if (newText) {
                const taskTitle = currentEditingTask.querySelector('.task-title');
                const priorityTag = currentEditingTask.querySelector('.task-tag');
                
                taskTitle.textContent = newText;
                priorityTag.className = `task-tag ${newPriority}`;
                priorityTag.textContent = `${newPriority} priority`;
            }
            
            closeTaskEdit();
        }

        // åˆå§‹åŒ–äº‹ä»¶ç›‘å¬
        document.addEventListener('DOMContentLoaded', () => {
            // ç‚¹å‡»èƒŒæ™¯å…³é—­æ¨¡æ€æ¡†
            document.getElementById('modal-backdrop').addEventListener('click', closeTaskEdit);
            
            // æŒ‰ä¸‹å›è½¦æ·»åŠ ä»»åŠ¡
            document.getElementById('new-task-input').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    addTask();
                }
            });
        });
    </script>
    <!-- ç¼–è¾‘æ¨¡æ€æ¡† -->
    <div class="modal-backdrop" id="modal-backdrop"></div>
    <div class="task-edit-modal" id="task-edit-modal">
        <h3><i class="fas fa-edit"></i> ç¼–è¾‘ä»»åŠ¡</h3>
        <div class="form-row" style="margin-bottom: 15px;">
            <input type="text" id="edit-task-input" placeholder="ä»»åŠ¡åç§°">
        </div>
        <div class="form-row" style="margin-bottom: 15px;">
            <select id="edit-task-priority">
                <option value="high">ğŸ”´ é«˜ä¼˜å…ˆçº§</option>
                <option value="medium">ğŸŸ¡ ä¸­ä¼˜å…ˆçº§</option>
                <option value="low">ğŸ”µ ä½ä¼˜å…ˆçº§</option>
            </select>
        </div>
        <div class="button-group">
            <button class="save" onclick="saveTaskEdit()" data-tooltip="ä¿å­˜ä¿®æ”¹">
                <i class="fas fa-check"></i>
            </button>
            <button class="cancel" onclick="closeTaskEdit()" data-tooltip="å–æ¶ˆç¼–è¾‘">
                <i class="fas fa-times"></i>
            </button>
        </div>
    </div>


    {% include 'embed.html' %}
</body>
</html>
